# breakdown
## неписи и диалоги
Игрок умеет с чем-то взаимодействовать. На нем висит PlayerInteract.  
Взаимодействует он с чем-то, что являет собой "взаимодействуемое", то есть реализует интерфейс IInteractable
Непись сам по себе отвечает только за вывод диалога, потому что только это он и умеет делать.
В последствие может быть он научится выдавать предметы - это не проблема(у меня в лабах реализовано норм - можно спиздить)
---
Итак, как происходит взаимодействие: в PlayerInteraсt есть метод GetInteractable - он берет ближайшие интерактивные объекты(делящие интерфейс IInteractable)
и если они ЕСТЬ, то производит с ними взаимодействие.
<details>
  <summary>Два вида взаимодействия</summary>
У ВСЕХ интерактивных объектов есть два варианта как с ними взаимодействовать: продолжительно или кратковременно.<br>
Это у меня определяется enum параметром в инспекторе. И в зависимости от типа enum-

1. Продолжительная - диалог, мини-игры и тд, также приближает камеру - но это зависит от конкретной реализации. 
    * для этого интеракта надо бы прикрутить стейт машину, но я не разбираюсь, так что сами как-нибудь 
      * если что на 27 строке в PlayerInteract.cs мы получаем InteractionType, так что можно в зависимости от него там как-нибудь менять стейт хз короче
2. Кратковременная - подобрать предмет, взломать турель, <s>вызвать шл</s>
</details> 

## противник скользит по наклонной поверхности.
чего хотим добиться?
  пофиксить текущее неправомерное поведение. Как конкретно? что должно быть в итоге?
  1) когда противник подбегает к наклонной плоскости, он поворачивается на такой угол, что идет ножками по наклонной плоскости с уменьшенной скоростью\с такой же скоростью (вектор его скорости параллелен наклону плоскости)
  2) противник бегает все так же без наклона. Когда забегает на наклонную плоскость, то идёт по ней, но  если  понимает, что он не в состоянии преодолеть эту наклонную плоскость (когда его скорость по x = 0), то он разворачивается 
  3) противник в принципе не может зайти на наклонную плоскость
чо делать
если просто сделать проверку на скорость х = 0, то он будет разворачиваться, даже в случае, когда мы его бьем и он получает knockback.
поэтому такое поведение лучше сделать специфичным для наклонной плоскости. возможно не очень универсально, но рабоче. у нас много чего не универсально
итак. Проверяем угол плоскости по рейкасту. Если он больше 0, то начинаем сравнивать. Если скорость <=0 то разворот.

# changes
## неписи и диалоги платона
- создано три скрипта: 
  1. NPC:IInteractable
  2. (interface) IInteractable
  3. PlayerInteract
- (!!) **скрипт PlayerInteract висит на Character префабе, потому что я не пон как мне инициализировать персика вместе с этим скриптом.**
- основнвые неписи(секретный уровень не трогал) переведены на PrefabVariant
- в неписе теперь нет  скрипта PlayerMeeting.
- DialogueWindow и сопутствующие теперь подтягиваются автоматически с помощью тега "DialogueWindow" внутри NPC
  * правда он теперь по дефолту активен на сцене, но логику этого можете сами поменять если не нравится (поиск диалогового окна происходит в скрипте NPC)
- логику печатания НЕ МЕНЯЛ 
>если что-то по мелочи забыл ИЗВИНИТЕ

## переделки интерактивных объектов
- теперь за интеракт отвечает предмет, с которым можно взаимодействовать а не игрок
- добавлен абстрактный класс Interactable от которого наследуется непись, а в последствии МОЖЕТ БЫТЬ ПРЕДМЕТ
- добавлен индиктор взаимодействия

## противник скользит по наклонной поверхности.
раньше было 3 рейкаста: из лица, из переднего края снизу, из центра низа: последние 2 проверяли по сути одно и то же.
теперь есть рейкасты: из лица, из переднего края снизу. И они разнесены в разные методы, чтобы можно их вызывать отдельно
раньше логика была такая, что если под челиком ничего нет, то он становится инвалидом.   
Это приводило к тому, что на малейшем подскоке он инвалидился. 
Теперь добавлена дополнительная проверка, что модуль его скорости по y должен быть больше чем, например 0.2f(то есть он летит), 
чтобы у противника отнимался контроль.

Также добавлена SlopeBehavior, которая вызывается в CheckUnder. Если угол наклона плоскости под ногами противника больше чем 
совсем небольшой Threshold, то ЕСЛИ противнику не хватает скорости для преодоления наклона (скорость стремится к нулю), 
то челик просто разворачивается

# suggestions
1. Перевести игровых персонажей на Prefab Variant от Character, 
   1. В Character добавить все скрипты, чтобы лишний раз себе мозги не ебать перетаскиванием или добавлением в скрипт(хз как оно реализовано)
   2. Сделать пустой Character Prefab полностью живым и ходибельным, чтобы можно было запускать сцены с какой-то болванкой (e.g. пусть карамелька будет дефолтным персиком)
2. Успокоить камеру в вертикальных перемещениях
3. Сделать инпут ХОДЫТ на стрелочки, а в атаку добавить X(eng) и K(eng) 
4. Сделать стейт "дизаблед", чтобы например в диалоге челик не мог ходыт и бытъ.
   - если че проверка "близко ли игрок" находится в Interactable
   - сделать надо так, чтобы Interactable НЕ ПРОВЕРЯЛ IsPlayerNearby, когда он в состоянии ContinuousInteraction